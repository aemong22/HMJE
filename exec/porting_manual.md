# ğŸ“ší¬íŒ… ë©”ë‰´ì–¼

## ğŸ“‘ëª©ì°¨

### [1. ê¸°ìˆ  ìŠ¤íƒ & ë²„ì „ ì •ë³´](#ê¸°ìˆ -ìŠ¤íƒ-ë²„ì „-ì •ë³´)

### [2. ë¹Œë“œ ë°©ë²•](#ë¹Œë“œ-ë°©ë²•)

### [3. Docker & Jenkins](#docker-jenkins)

### [4. ê¸°íƒ€ ì„¤ì •](#ê¸°íƒ€-ì„¤ì •)

---

## ğŸ› ê¸°ìˆ  ìŠ¤íƒ & ë²„ì „ ì •ë³´

### 1. ì´ìŠˆê´€ë¦¬

<img src="https://img.shields.io/badge/Jira-0052CC?style=for-the-badge&logo=Jira&logoColor=white">

</br>

### 2. í˜•ìƒê´€ë¦¬

<img src="https://img.shields.io/badge/Gitlab-FC6D26?style=for-the-badge&logo=Gitlab&logoColor=white">

</br>

### 3. ì»¤ë®¤ë‹ˆì¼€ì´ì…˜

<img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white"> <img src="https://img.shields.io/badge/Mattermost-0058CC?style=for-the-badge&logo=Mattermost&logoColor=white">

</br>

### 4. ê°œë°œ í™˜ê²½

#### **IDE**

<img src="https://img.shields.io/badge/Intellij 2022.3.1-000000?style=for-the-badge&logo=IntelliJ IDEA&logoColor=white">
<img src="https://img.shields.io/badge/Visual Studio Code 1.74-007ACC?style=for-the-badge&logo=Visual Studio Code&logoColor=white">

#### **DB**

<img src="https://img.shields.io/badge/MySQL 8.0.31-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">
<img src="https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=Redis&logoColor=white">

#### **UI/UX**

<img src="https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=Figma&logoColor=white">

#### **Server**

<img src="https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=Amazon AWS&logoColor=white">
<img src="https://img.shields.io/badge/Naver Cloud-03C75A?style=for-the-badge&logo=Naver&logoColor=white">
<img src="https://img.shields.io/badge/NGINX_stable_alpine-009639?style=for-the-badge&logo=NGINX&logoColor=white">

</br>

### 5. ìƒì„¸

#### **Backend**

<img src="https://img.shields.io/badge/Java_1.8-FF0000?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/Spring_Boot_2.7.8-6DB33F?style=for-the-badge&logo=Spring Boot&logoColor=white">
<img src="https://img.shields.io/badge/Spring Security_5.7.6-6DB33F?style=for-the-badge&logo=Spring Security&logoColor=white">
<img src="https://img.shields.io/badge/Gradle 7.6-02303A?style=for-the-badge&logo=Gradle&logoColor=white">
<img src="https://img.shields.io/badge/JPA-009639?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/JWT-000000?style=for-the-badge&logo=JSON Web Tokens&logoColor=white">

#### **Frontend**

<img src="https://img.shields.io/badge/React_18.2.0-61DAFB?style=for-the-badge&logo=React&logoColor=white">
<img src="https://img.shields.io/badge/Node.js_18.12.1-339933?style=for-the-badge&logo=Node.js&logoColor=white">
<img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=TypeScript&logoColor=white">
<img src="https://img.shields.io/badge/JavaScript_Es2022-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white">
<img src="https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=HTML5&logoColor=white">
<img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=CSS3&logoColor=white">
<img src="https://img.shields.io/badge/Tailwind-06B6D4?style=for-the-badge&logo=Tailwind CSS&logoColor=white">
<img src="https://img.shields.io/badge/Redux-764ABC?style=for-the-badge&logo=Redux&logoColor=white">
<img src="https://img.shields.io/badge/React Router
-CA4245?style=for-the-badge&logo=React Router
&logoColor=white">
<img src="https://img.shields.io/badge/React_Query_3.39.2-FF4154?style=for-the-badge&logo=React Query&logoColor=white">
<img src="https://img.shields.io/badge/three.js-000000?style=for-the-badge&logo=Three.js&logoColor=white">
<img src="https://img.shields.io/badge/Chart.js-FF6384?style=for-the-badge&logo=Chart.js&logoColor=white">

#### **AI**
<img src="https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=Python&logoColor=white">
<img src="https://img.shields.io/badge/Jupyter-F37626?style=for-the-badge&logo=Jupyter&logoColor=white">
<img src="https://img.shields.io/badge/PyTorch-EE4C2C?style=for-the-badge&logo=PyTorch&logoColor=white">
<img src="https://img.shields.io/badge/KoNLPy-CA4245?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/Librosa-764ABC?style=for-the-badge&logo=&logoColor=white">


#### **CI/CD**

<img src="https://img.shields.io/badge/Docker_20.10.23-2496ED?style=for-the-badge&logo=Docker&logoColor=white">
<img src="https://img.shields.io/badge/Jenkins_lts-D24939?style=for-the-badge&logo=Jenkins&logoColor=white">

---
## âš™ë¹Œë“œ ë°©ë²•

### â—¼BE

1. **`back-server`** í”„ë¡œì íŠ¸ ì—´ê¸°
2. JDK 1.8 ë²„ì „ í™•ì¸
3. src/main/BackApplication class ì‹¤í–‰

### â—»FE

1. **`front-server`** ë¡œ ì´ë™
2. npm install
3. npm install react-wordcloud --save --legacy-peer-deps (react-wordcloud ì˜¤ë¥˜ë¡œ ì¸í•´ ë”°ë¡œ ì„¤ì¹˜)
4. npm start

### â—¼AI

1. **`python-server/tts_api`** ë¡œ ì´ë™
2. pip install -r requirements.txt
3. python flask_tts.py

---

 ## ğŸŒDocker & Jenkins

<img src = "./img/back-front-server.png" />
<img src = "./img/ai.png" />

### 1. ì„œë²„ ì ‘ì†
```bash
# Window Terminal ì‚¬ìš©
## - Naver Cloud ì„œë²„ : Front, Back ì„œë²„ ( ì‚¬ìš©ì ê³„ì • ìƒì„± í›„ ì‚¬ìš© )
## - ssafy ì œê³µ ì„œë²„ : AI ì„œë²„ ( pem í‚¤ ì‚¬ìš© )
ssh [ì‚¬ìš©ì-ê³„ì •-ì•„ì´ë””]@[íƒ„ë ¨ì IP/ë„ë©”ì¸ ì£¼ì†Œ] => ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ ì ‘ì†
ssh -i [í‚¤ëª….pem] ubuntu@[íƒ„ë ¨ì IP/ë„ë©”ì¸ ì£¼ì†Œ]
```

### 2. ê¸°ë³¸ ì„¤ì •
```bash
# ë°©í™”ë²½ ì„¤ì •
sudo ufw allow 22 # ssh
sudo ufw allow 80 # http 
sudo ufw allow 443 # ssl
sudo ufw allow [8080/5000/9090/...] # í•„ìš”í•œ í¬íŠ¸ ë²ˆí˜¸ ê°œë°©
sudo ufw enable
# ìƒíƒœ í™•ì¸
sudo ufw status
```
### 3. Docker ì„¤ì¹˜
```bash
# ì‚¬ì „ íŒ¨í‚¤ì§€ ì„¤ì¹˜
sudo apt update
sudo apt-get install -y ca-certificates \
    curl \
    software-properties-common \
    apt-transport-https \
    gnupg \
    lsb-release

# gpg í‚¤ ë‹¤ìš´ë¡œë“œ : í”„ë¡œê·¸ë¨ íŒ¨í‚¤ì§€ê°€ ìœ íš¨í•œì§€ í™•ì¸í•˜ê¸° ìœ„í•´ gpgí‚¤ë¥¼ í†µí•´ ê²€ì¦
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

echo \
    "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Docker ì„¤ì¹˜
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io docker-compose
```

### 4. ì  í‚¨ìŠ¤ ì„¤ì¹˜
#### ì  í‚¨ìŠ¤ ì„¤ì¹˜
- docker-copmpose.yml ìƒì„± : vim ì´ìš©
```yml
version: '3'

services:
    jenkins:
        image: jenkins/jenkins:lts
        container_name: jenkins
        volumes:
            - /usr/bin/docker:/usr/bin/docker
            - /var/run/docker.sock:/var/run/docker.sock
            - /jenkins:/var/jenkins_home
            - /home/[ì‚¬ìš©ì-ê³„ì •]/certbot:/var/certbot
        ports:
            - "9090:8080"
        privileged: true
        user: root
    redis:
        image: redis:latest
        container_name: redis
        command: redis-server --port 6379
        hostname: redis
        ports:
            - 6379:6379
```
```bash
# ssl ì„¤ì •
cd
sudo mkdir certbot
cd certbot
sudo mkdir conf www logs
sudo docker pull certbot/certbot
# certbotì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” 80 í¬íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼í•œë‹¤.
# ë”°ë¼ì„œ, 80 í¬íŠ¸ë¥¼ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì‚¬ìš©í•´ì•¼í•œë‹¤ë©´ ë¨¼ì € certbotì„ ì‹¤í–‰í•œ í›„ ì‚¬ìš©í•´ì•¼í•œë‹¤.
sudo docker run -it --rm --name certbot -p 80:80 -v "/home/ubuntu/certbot/conf:/etc/letsencrypt" -v "/home/ubuntu/certbot/log:/var/log/letsencrypt" -v "/home/ubuntu/certbot/www:/var/www/certbot" certbot/certbot certonly

# ì»¨í…Œì´ë„ˆ ìƒì„±
sudo docker-compose up -d

# ì»¨í…Œì´ë„ˆ í™•ì¸
sudo docker ps
```
#### ì  í‚¨ìŠ¤ ì„¤ì •
```bash
# ì  í‚¨ìŠ¤ Administrator password í™•ì¸
sudo docker logs jenkins

1. ì„œë²„ ê³µì¸ IP:9090 => ì  í‚¨ìŠ¤ ì ‘ì†
2. ê´€ë¦¬ì ì ‘ì†([docker logs jenkins]ë¡œ íŒ¨ìŠ¤ì›Œë“œ í™•ì¸)
3. ê¸°ë³¸ í”ŒëŸ¬ê·¸ì¸ ìë™ ì„¤ì¹˜
4. ì  í‚¨ìŠ¤ ê³„ì • ìƒì„±
5. Jenkins ê´€ë¦¬ -> í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬ -> ì„¤ì¹˜ ê°€ëŠ¥
6. gitlab í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ : GitLab, Generic Webhook Trigger, Gitlab API, GitLab Authentication
7. docker í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ : Docker, Docker Commons, Docker Pipeline, Docker API
8. SSH í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ : Publish OPver SSH
```
### 5. NGINX ì„¤ì •
#### Front, Back Server Nginx Confing
```bash
#######################################
# Frontend, Backend Server Config
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen       80;
    # listen  [::]:80;
    server_name  [ê³µì¸ IP];

    location / {
        return 301 https://$host$request_uri;
    }
}
server{
    listen 443 ssl;
    # listen [::]:443;

    server_name [ê³µì¸ IP];
    
    access_log  /var/log/nginx/access.log;
    error_log  /var/log/nginx/error.log;

    ssl_certificate /etc/letsencrypt/live/[ë„ë©”ì¸ ì£¼ì†Œ]/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/[ë„ë©”ì¸ ì£¼ì†Œ]/privkey.pem;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv3;
    ssl_ciphers ALL;


    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }

	location /api {
        proxy_pass http://[ê³µì¸ IP]:[í¬íŠ¸ë²ˆí˜¸];
        proxy_redirect off;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

#### AI(TTS) Server Nginx Confing
```bash
#######################################
# AI Server Config
map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

server {
    listen       80;
    listen  [::]:80;
    server_name  [ê³µì¸ IP];


    location / {
        return 301 https://$host$request_uri;
    }
}

server{
    listen 443 ssl;
    listen [::]:443;

    server_name [ê³µì¸ IP];
    
    access_log  /var/log/nginx/access.log;
    error_log  /var/log/nginx/error.log;

    ssl_certificate /etc/letsencrypt/live/[ë„ë©”ì¸ ì£¼ì†Œ]/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/[ë„ë©”ì¸ ì£¼ì†Œ]/privkey.pem;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 SSLv3;
    ssl_ciphers ALL;

    location / {
        proxy_pass http://[ê³µì¸ IP]:[í¬íŠ¸ë²ˆí˜¸];
        
        proxy_redirect off;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

### 6. DockerFile ìƒì„±
> Naver Cloud Server
#### Back-End
```Dockerfile
# **/back-server/DockerFile
FROM adoptopenjdk/openjdk11 AS builder

COPY gradlew .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .
COPY src src
RUN chmod +x ./gradlew
RUN ./gradlew bootJAR

FROM adoptopenjdk/openjdk11
COPY --from=builder build/libs/*.jar app.jar
EXPOSE 8080 
ENTRYPOINT ["java", "-jar", "/app.jar"]

```
#### Front-End
```Dockerfile
# **/front-server/DockerFile
FROM node:18.12.1 as build-stage
WORKDIR /var/jenkins_home/workspace/hmje-deploy/front-server
COPY package*.json ./
RUN npm install
RUN npm install react-wordcloud --save --legacy-peer-deps
COPY . .
RUN npm run build
FROM nginx:stable-alpine as production-stage

COPY --from=build-stage /var/jenkins_home/workspace/hmje-deploy/front-server/build /usr/share/nginx/html
COPY --from=build-stage /var/jenkins_home/workspace/hmje-deploy/front-server/deploy-conf/nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g","daemon off;"]

```
#### ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë‹¨ì–´
```Dockerfile
# **/python-server/news_word/DockerFile
FROM ubuntu:18.04
WORKDIR /var/jenkins_home/workspace/hmje-deploy/python-server/news_word

# ëª¨ë“  íŒŒì¼.
COPY * ./

# timezone
ENV TZ=Asia/Seoul
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# python, jdk
RUN apt-get update
RUN apt-get install software-properties-common -y
RUN add-apt-repository ppa:webupd8team/java
RUN add-apt-repository ppa:deadsnakes/ppa
RUN apt-get update
RUN apt-get install python3.10 -y
RUN apt-get install g++ openjdk-8-jdk curl -y
RUN curl -sS https://bootstrap.pypa.io/get-pip.py | python3.10
RUN python3.10 -m pip install --upgrade pip --user
RUN python3.10 -m pip install konlpy
RUN python3.10 -m pip install -r requirements.txt

# Add the script to the Docker Image
ADD news_word.sh /root/news_word.sh
ADD 2016-10-20.txt /root/2016-10-20.txt

# Give execution rights on the cron scripts
RUN chmod 0644 /root/news_word.sh
RUN chmod 0644 /root/2016-10-20.txt

# cron
RUN apt-get update
RUN apt-get -y install cron

# Add the cron job
RUN crontab -l | { cat; echo "0 12 * * * bash /root/news_word.sh"; } | crontab -
RUN crontab -l | { cat; echo "0 0 * * * bash /root/news_word.sh"; } | crontab -

CMD ["cron", "-f"]
```
> AWS Server
#### AI(TTS)
```Dockerfile
# **/python-server/tts_api/DockerFile
FROM ubuntu:18.04
WORKDIR /var/jenkins_home/workspace/hmje-deploy/python-server/tts_api

# ëª¨ë“  íŒŒì¼.
COPY * /root/

# timezone
ENV TZ=Asia/Seoul
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# python, jdk
RUN apt-get update
RUN apt-get install software-properties-common -y
RUN add-apt-repository ppa:webupd8team/java
RUN add-apt-repository ppa:deadsnakes/ppa
RUN apt-get update
RUN apt-get install python3.9 -y
RUN apt-get install g++ openjdk-8-jdk curl -y
RUN apt-get install -y python3.9-distutils python3.9-dev unzip llvm
RUN curl -sS https://bootstrap.pypa.io/get-pip.py -o get-pip.py
RUN python3.9 get-pip.py --user
RUN python3.9 -m pip install --upgrade pip --user

RUN unzip -q /root/TTS.zip -d /root/TTS
RUN unzip -q /root/g2pK.zip -d /root/g2pK

RUN python3.9 -m pip install -q --no-cache-dir "konlpy" "jamo" "nltk" "python-mecab-ko"
RUN python3.9 -m pip install -q --no-cache-dir -e /root/g2pK

RUN python3.9 -m pip install -r /root/requirements.txt

RUN chmod 0644 /root/flask_tts_api.py
RUN chmod 0644 /root/tts.py

EXPOSE 8080
ENTRYPOINT ["python3.9", "/root/flask_tts_api.py"]
```
#### AI(TTS) - Nginx
```Dockerfile
FROM nginx:stable-alpine as production-stage

COPY ./nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g","daemon off;"]
```

### 7. Jenkins Shell Script
> Naver Cloud Server
#### â—¼Back-End
```bash
docker build -t backimg ./back-server
if (docker ps | grep "backimg"); then docker stop backimg; fi
docker run -it -d --rm -p 8080:8080 --net redis-net --name backimg backimg
echo "Run back-server"

```
#### â—¼Front-End
```bash
docker build -t frontimg ./front-server
if (docker ps | grep "frontimg"); then docker stop frontimg; fi
docker run -it -d --rm -p 80:80 -p 443:443 --net redis-net -v /home/hmje/certbot/conf:/etc/letsencrypt --name frontimg frontimg
echo "Run front-server"
```
#### â—¼python-news
```bash
docker build -t newsimg ./python-server/news_word
if (docker ps | grep "newsimg"); then docker stop newsimg; fi
docker run -it -d --rm --name newsimg newsimg
echo "Run python-server-news"
```
> AWS Server
#### â—¼ AI(TTS)
```bash
rm -rf ./python-server/tts_api/tts
cp -r /root/tts ./python-server/tts_api/tts
docker build -t ttsimg ./python-server/tts_api
if (docker ps | grep "ttsimg"); then docker stop ttsimg; fi
docker run -it --rm -d -p 8080:8080 -v /home/ubuntu/tts0-cee7a-firebase-adminsdk-lg9cn-a7b4664123.json:/root/tts0-cee7a-firebase-adminsdk-lg9cn-a7b4664123.json --name ttsimg ttsimg
echo "Run python-server-tts"
```
#### â—¼ AI(TTS) - NGINX
```bash
docker build -t nginximg ./python-server/nginx_conf
if (docker ps | grep "nginximg"); then docker stop nginximg; fi
docker run -it -d --rm -p 80:80 -p 443:443 -v /home/ubuntu/certbot/conf:/etc/letsencrypt --name nginximg nginximg
echo "Run nginx"
```

## ê¸°íƒ€ ì„¤ì •
### 1. DB : MySQL
> back-server/src/main/resources/application.properties
```properties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://{Domain}:{Port}/{DB_Name}?serverTimezone=Asia/Seoul&zeroDateTimeBehavior=convertToNull
spring.datasource.username={username}
spring.datasource.password={password}
```
### 2. Redis
> back-server/src/main/resources/application.properties
```properties
# dockerë¡œ back, redisë¥¼ ì‹¤í–‰í•˜ê³  ê°™ì€ ë„¤íŠ¸ì›Œí¬ë¡œ ë¬¶ìœ¼ë©´
# ì»¨í…Œì´ë„ˆëª…ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥
spring.redis.host=redis
spring.redis.port=6379
```
### 3. Naver Cloud SMS Service
> back-server/src/main/resources/application-API-KEY.properties
```properties
naver-cloud-sms.serviceId=
naver-cloud-sms.accessKey=
naver-cloud-sms.secretKey=
naver-cloud-sms.senderPhone=
```
